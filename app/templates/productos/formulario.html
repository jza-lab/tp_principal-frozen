{% extends 'layouts/app_layout.html' %}

{% set form_title = 'Editar producto' if is_edit else 'Agregar Nuevo producto' %}

{% block title %}{{ form_title }} - Sistema Frozen{% endblock %}

{% block extra_css %}
    <style>
        /* 1. Hacemos que la columna de ayuda se estire verticalmente
           para igualar a su hermana (la columna del formulario).
        */
        #columna-ayuda {
            display: flex;
            flex-direction: column;
        }

        /* 2. Hacemos que la tarjeta de ayuda (el .card) crezca
           para llenar todo el espacio vertical disponible en su columna.
        */
        #columna-ayuda .card {
            flex-grow: 1;
        }
    </style>
{% endblock %}

{% block page_title %}{{ form_title }}{% endblock %}
{% block page_subtitle %}
{% if is_edit %}
Modificar información de {{ producto['nombre'] }}
{% else %}
Agregar nuevo producto al catálogo
{% endif %}
{% endblock %}
{% block page_actions %}
<a href="{{ url_for('productos.obtener_productos') }}" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left me-1"></i>Volver a la lista
</a>
{% endblock %}

{% block app_content %}
<div class="row">
    <div class="col-lg-8 col-xl-9">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Información del Producto</h5>
            </div>
            <div class="card-body">
                <form id="formulario-producto" method="POST">
                    {{ csrf_form.csrf_token }}
                    <div class="row g-3">
                        {% if is_edit %}
                        <div class="col-md-6">
                            <label for="codigo" class="form-label">Código</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-upc-scan"></i></span>
                                <input type="text" class="form-control" name="codigo" id="codigo"
                                    value="{{ producto['codigo'] }}" readonly>
                            </div>
                            <div class="form-text">El código de producto no se puede modificar.</div>
                        </div>
                        {% endif %}

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="text" class="form-control" name="nombre" id="nombre"
                                    value="{{ producto['nombre'] if producto else '' }}" required placeholder="Nombre">
                                <label for="nombre">
                                    <i class="bi bi-box-seam me-1"></i>Nombre <span class="text-danger">*</span>
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <select class="form-select" name="categoria" id="categoria" required>
                                    <option value="">Seleccionar categoría...</option>
                                    <option value="Congelados" {% if producto and producto['categoria']=="Congelados"
                                        %}selected{% endif %}>
                                        Congelados (Milanesas, hamburguesas, etc.)
                                    </option>
                                    <option value="Otros" {% if producto and producto['categoria']=='Otros' %}selected{%
                                        endif %}>
                                        Otros
                                    </option>
                                </select>
                                <label for="categoria">
                                    <i class="bi bi-tags-fill me-1"></i>Categoría <span class="text-danger">*</span>
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating">
                                <input type="number" class="form-control" name="vida_util_dias" id="vida_util_dias"
                                    value="{{ producto['vida_util_dias'] if producto else '0' }}" required min="0" placeholder="Vida útil (días)">
                                <label for="vida_util_dias">
                                    <i class="bi bi-heart-pulse me-1"></i>Vida útil (días)
                                </label>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <label class="form-label">Compatibilidad de Línea <span class="text-danger">*</span></label>
                            <div class="d-flex gap-3 pt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="linea_compatible" id="linea_1_compatible" value="1">
                                    <label class="form-check-label" for="linea_1_compatible">
                                        Línea 1 (Moderna)
                                    </label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="linea_compatible" id="linea_2_compatible" value="2" checked>
                                    <label class="form-check-label" for="linea_2_compatible">
                                        Línea 2 (Clásica)
                                    </label>
                                </div>
                            </div>
                            <div class="form-text">
                                Define en qué línea se puede fabricar esta receta.
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <select class="form-select" name="unidad_medida" id="unidad_medida" required>
                                    <option value="">Seleccionar unidad...</option>
                                    <option value="t" {% if producto and producto['unidad_medida']=='t' %}selected{% endif
                                        %}>Toneladas (t)</option>
                                    <option value="kg" {% if producto and producto['unidad_medida']=='kg' %}selected{%
                                        endif %}>Kilogramos (kg)</option>
                                    <option value="g" {% if producto and producto['unidad_medida']=='g' %}selected{% endif
                                        %}>Gramos (g)</option>
                                    <option value="litros" {% if producto and producto['unidad_medida']=='litros'
                                        %}selected{% endif %}>Litros (l)</option>
                                    <option value="unidades" {% if producto and producto['unidad_medida']=='unidades'
                                        %}selected{% endif %}>Unidades</option>
                                    <option value="paquete" {% if producto and (producto['unidad_medida'] | string |
                                        lower)[:7]=='paquete' %}selected{% endif %}>Paquete</option>
                                </select>
                                <label for="unidad_medida">
                                    <i class="bi bi-rulers me-1"></i>Unidad de Venta <span class="text-danger">*</span>
                                </label>
                            </div>

                            <div class="row g-3" id="unidades-paquete-group"
                                style="display: {{ 'block' if producto and (producto['unidad_medida'] | string | lower)[:7] == 'paquete' else 'none' }};">

                                <div class="col-6">
                                    <label for="tipo_paquete" class="form-label small">Se mide por:</label>
                                    <select class="form-select" name="tipo_paquete" id="tipo_paquete">
                                        <option value="unidades" {% if producto and producto['unidades_por_paquete']> 1
                                            %}selected{% endif %}>Unidades</option>
                                        <option value="peso_volumen" {% if producto and producto['peso_por_paquete_valor']>
                                            0 %}selected{% endif %}>Peso/Volumen</option>
                                    </select>
                                </div>

                                <div class="col-6">

                                    <div id="unidades-paquete-fields" style="display: none;">
                                        <label for="unidades_por_paquete" class="form-label small">Cant.
                                            Unidades</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-box"></i></span>
                                            <input type="number" step="1" min="1" max="1000" class="form-control"
                                                name="unidades_por_paquete" id="unidades_por_paquete"
                                                value="{{ producto['unidades_por_paquete'] if producto and producto['unidades_por_paquete'] else '1' }}">
                                            <span class="input-group-text">u</span>
                                        </div>
                                    </div>

                                    <div id="peso-paquete-fields" style="display: none;">
                                        <label for="peso_por_paquete_valor" class="form-label small">Peso por
                                            Paquete</label>
                                        <div class="input-group">
                                            <input type="number" step="0.01" min="0.01" max="1000" class="form-control"
                                                name="peso_por_paquete_valor" id="peso_por_paquete_valor"
                                                value="{{ producto['peso_por_paquete_valor'] if producto and producto['peso_por_paquete_valor'] else '1.00' }}">

                                            <select class="form-select" name="peso_por_paquete_unidad"
                                                id="peso_por_paquete_unidad" style="max-width: 100px;">
                                                <option value="kg" {% if producto and
                                                    producto['peso_por_paquete_unidad']=='kg' %}selected{% endif %}>kg
                                                </option>
                                                <option value="g" {% if producto and
                                                    producto['peso_por_paquete_unidad']=='g' %}selected{% endif %}>g
                                                </option>
                                                <option value="litros" {% if producto and
                                                    producto['peso_por_paquete_unidad']=='litros' %}selected{% endif %}>l
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-12">
                                    <div class="form-text mt-2" id="paquete-info-text">
                                        Define la medida del producto al venderse como paquete.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12">
                            <label for="descripcion" class="form-label">Descripción</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="bi bi-card-text"></i></span>
                                <textarea class="form-control" name="descripcion" id="descripcion"
                                    rows="3">{{ producto['descripcion'] if producto else '' }}</textarea>
                            </div>
                            <div class="form-text">Opcional - Ingrese una descripción detallada del producto.</div>
                        </div>
                    </div>

                    <div class="card my-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Ítems de la receta del producto</h5>
                            <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#insumoSearchModal">
                                <i class="bi bi-plus-circle me-1"></i>Añadir Ítem
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="itemsContainer">
                                {% for item in receta_items %}
                                <div class="row g-3 align-items-end item-row mb-2">
                                    <div class="col-md-4">
                                        <label class="form-label">Insumo</label>
                                        <select class="form-select insumo-selector" name="insumo_id[]" required>
                                            <option value="">Seleccione un insumo...</option>
                                            {% for insumo in insumos %}
                                            <option value="{{ insumo.id }}" data-id="{{ insumo.id }}"
                                                data-unidad="{{ insumo.unidad_medida }}"
                                                data-precio="{{ insumo.precio_unitario }}" {% if
                                                insumo.id_insumo==item.id_insumo %}selected{% endif %}>
                                                {{ insumo.nombre }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Cantidad <span
                                                class="unidad-receta-display"></span></label>
                                        <input type="number" step="0.01" min="0.01" max="5000"
                                            class="form-control cantidad" name="cantidad[]" value="{{ item.cantidad }}"
                                            required>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Precio Unitario</label>
                                        <input type="text" class="form-control precio_unitario" name="precio_unitario[]"
                                            value="{{ item.precio_unitario }}" readonly>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Subtotal</label>
                                        <input type="text" class="form-control subtotal-item"
                                            value="{{ (item.cantidad * item.precio_unitario) | round(2) }}" readonly>
                                    </div>
                                    <div class="col-md-2">
                                        <button type="button"
                                            class="btn btn-outline-danger removeItemBtn">Eliminar</button>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="card my-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Mano de Obra de la Receta</h5>
                            <button type="button" class="btn btn-sm btn-outline-success" id="add-mano-obra-btn">
                                <i class="bi bi-plus-circle me-1"></i>Añadir Rol
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="mano-obra-container">
                                <!-- Las filas de mano de obra se añadirán aquí dinámicamente -->
                                {% if receta and receta.mano_de_obra %}
                                    {% for mo in receta.mano_de_obra %}
                                    <div class="row g-3 align-items-end item-row mb-2">
                                        <div class="col-md-5">
                                            <label class="form-label">Rol</label>
                                            <select class="form-select mano-obra-rol" name="mano_obra_rol_id[]" required>
                                                <option value="">Seleccione un rol...</option>
                                                {% for rol in roles %}
                                                <option value="{{ rol.id }}" {% if rol.id == mo.rol_id %}selected{% endif %}>
                                                    {{ rol.nombre }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Horas Estimadas</label>
                                            <input type="number" step="0.25" min="0.25" class="form-control mano-obra-horas" name="mano_obra_horas[]" value="{{ mo.horas_estimadas }}" required>
                                        </div>
                                        <div class="col-md-3">
                                            <button type="button" class="btn btn-outline-danger remove-mano-obra-btn">Eliminar</button>
                                        </div>
                                    </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="card my-4">
                        <div class="card-header">
                            <h5 class="mb-0">Pasos de Producción (Tiempos Estimados)</h5>
                        </div>
                        <div class="card-body">
                            <p class="card-text small text-muted">
                                Define los tiempos estándar para los pasos de producción. Podrás editar o añadir más pasos detallados más tarde en el módulo de Recetas.
                            </p>
                            
                            <div class="row g-3 align-items-center mb-2 border-bottom pb-2">
                                <div class="col-md-3"><label class="form-label fw-bold">1. Preparación Previa</label></div>
                                <div class="col-md-4">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text" title="Tiempo de Preparación">Prep.</span>
                                        <input type="number" class="form-control" id="step_prep_1" value="1" min="0" step="1">
                                        <span class="input-group-text">min</span>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text" title="Tiempo de Ejecución por Unidad">Ejec.</span>
                                        <input type="number" class="form-control" id="step_ejec_1" value="0.1" min="0" step="0.01">
                                        <span class="input-group-text">min/u</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-3 align-items-center mb-2 border-bottom pb-2">
                                <div class="col-md-3"><label class="form-label fw-bold">2. Cocción</label></div>
                                <div class="col-md-4">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">Prep.</span>
                                        <input type="number" class="form-control" id="step_prep_2" value="1" min="0" step="1">
                                        <span class="input-group-text">min</span>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">Ejec.</span>
                                        <input type="number" class="form-control" id="step_ejec_2" value="0.1" min="0" step="0.01">
                                        <span class="input-group-text">min/u</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row g-3 align-items-center mb-2 border-bottom pb-2">
                                <div class="col-md-3"><label class="form-label fw-bold">3. Refrigeración</label></div>
                                <div class="col-md-4">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">Prep.</span>
                                        <input type="number" class="form-control" id="step_prep_3" value="1" min="0" step="1">
                                        <span class="input-group-text">min</span>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">Ejec.</span>
                                        <input type="number" class="form-control" id="step_ejec_3" value="0.1" min="0" step="0.01">
                                        <span class="input-group-text">min/u</span>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-3 align-items-center">
                                <div class="col-md-3"><label class="form-label fw-bold">4. Empaquetado</label></div>
                                <div class="col-md-4">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">Prep.</span>
                                        <input type="number" class="form-control" id="step_prep_4" value="1" min="0" step="1">
                                        <span class="input-group-text">min</span>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <div class="input-group input-group-sm">
                                        <span class="input-group-text">Ejec.</span>
                                        <input type="number" class="form-control" id="step_ejec_4" value="0.1" min="0" step="0.01">
                                        <span class="input-group-text">min/u</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Cálculo de Costos y Precio</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Columna Izquierda: Desglose de Costos -->
                                <div class="col-md-6">
                                    <div class="list-group">
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1">Costo Materia Prima</h6>
                                                <small><i class="bi bi-info-circle" data-bs-toggle="tooltip" title="Suma del costo de todos los insumos de la receta."></i></small>
                                            </div>
                                            <p class="mb-1" id="display_costo_materia_prima">$ 0.00</p>
                                        </div>
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1">Costo Mano de Obra</h6>
                                                <small><i class="bi bi-info-circle" data-bs-toggle="tooltip" title="Suma de (horas * costo/h) de cada rol asignado."></i></small>
                                            </div>
                                            <p class="mb-1" id="display_costo_mano_obra">$ {{ "%.2f"|format(producto.costo_mano_obra|float) if producto else '0.00' }}</p>
                                        </div>
                                        <div class="list-group-item">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1">Costos Fijos Aplicados</h6>
                                                <small><i class="bi bi-info-circle" data-bs-toggle="tooltip" title="Porción de los costos fijos mensuales distribuida según las horas de producción."></i></small>
                                            </div>
                                            <p class="mb-1" id="display_costo_fijos">$ {{ "%.2f"|format(producto.costo_fijos|float) if producto else '0.00' }}</p>
                                        </div>
                                        <div class="list-group-item list-group-item-dark">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1 fw-bold">Costo Total Producción</h6>
                                            </div>
                                            <p class="mb-1 fw-bold" id="display_costo_total_produccion">$ {{ "%.2f"|format(producto.costo_total_produccion|float) if producto else '0.00' }}</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Columna Derecha: Precio de Venta -->
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="porcentaje_ganancia" class="form-label">Porcentaje Ganancia (%) <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="bi bi-graph-up-arrow"></i></span>
                                            <input type="number" step="0.01" min="0" class="form-control" id="porcentaje_ganancia" name="porcentaje_ganancia" value="{{ producto.porcentaje_ganancia if producto else '0' }}" required>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="iva" name="iva" value="1" {% if producto and producto.iva %}checked{% endif %}>
                                            <label class="form-check-label" for="iva">Aplicar IVA (21%)</label>
                                        </div>
                                    </div>
                                    <hr>
                                    <div>
                                        <label class="form-label fw-bold">Precio de Venta Final</label>
                                        <div class="input-group">
                                            <span class="input-group-text fw-bold">$</span>
                                            <input type="text" class="form-control fw-bold fs-4" id="display_precio_final" value="$ {{ '%.2f'|format(producto.precio_unitario|float) if producto else '0.00' }}" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-end gap-2 mt-4">
                        <a href="{{ url_for('productos.obtener_productos') }}"
                            class="btn btn-outline-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle me-1"></i>
                            {% if is_edit %}Actualizar{% else %}Crear{% endif %} producto
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4 col-xl-3" id="columna-ayuda">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="bi bi-info-circle me-1"></i> Ayuda</h6>
            </div>
            <div class="card-body">
                <div class="alert alert-light border">
                    <h6>Consejos importantes:</h6>
                    <ul class="mb-0 small">
                        <li>Use códigos cortos y descriptivos.</li>
                        <li>Categorice correctamente para facilitar los filtros.</li>
                        <li>Asegúrese de que todos los insumos de la receta estén disponibles en el catálogo.</li>
                        <li>El <strong>costo de mano de obra</strong> y la <strong>ganancia</strong> se calculan como porcentajes sobre el costo total de los insumos.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    const productoS_LISTA_URL = "{{ url_for('productos.obtener_productos') }}";
    const ID_producto = "{{ producto['id'] if producto else '' }}";
    const IS_EDIT = '{{ is_edit }}';
    const isEditBoolean = IS_EDIT == 'True';
    const INSUMOS_DATA = JSON.parse('{{ insumos | tojson | safe | replace("\n", "") | replace("\r", "") }}');
    const ROLES_DATA = JSON.parse('{{ roles | tojson | safe | replace("\n", "") | replace("\r", "") }}');

    document.addEventListener('DOMContentLoaded', function () {
        const unidadMedidaSelect = document.getElementById('unidad_medida');
        const unidadesPaqueteGroup = document.getElementById('unidades-paquete-group');
        const tipoPaqueteSelect = document.getElementById('tipo_paquete');
        const unidadesPaqueteFields = document.getElementById('unidades-paquete-fields');
        const pesoPaqueteFields = document.getElementById('peso-paquete-fields');
        const paqueteInfoText = document.getElementById('paquete-info-text');

        const unidadesPaqueteInput = document.getElementById('unidades_por_paquete');
        const pesoPaqueteValorInput = document.getElementById('peso_por_paquete_valor');
        const pesoPaqueteUnidadSelect = document.getElementById('peso_por_paquete_unidad');


        function toggleTipoPaquete() {
            const tipo = tipoPaqueteSelect.value;
            let infoText = '';
            if (tipo === 'unidades') {
                unidadesPaqueteFields.style.display = 'block';
                pesoPaqueteFields.style.display = 'none';
                infoText = 'Define la cantidad de unidades individuales dentro del paquete.';
                unidadesPaqueteInput.setAttribute('required', 'required');
                unidadesPaqueteInput.removeAttribute('disabled');
                pesoPaqueteValorInput.removeAttribute('required');
                pesoPaqueteUnidadSelect.removeAttribute('required');
                pesoPaqueteValorInput.setAttribute('disabled', 'disabled');
                pesoPaqueteUnidadSelect.setAttribute('disabled', 'disabled');
                pesoPaqueteValorInput.value = 0;
                pesoPaqueteUnidadSelect.value = 'kg';
                if (parseFloat(unidadesPaqueteInput.value) <= 0) unidadesPaqueteInput.value = 1;
            } else if (tipo === 'peso_volumen') {
                unidadesPaqueteFields.style.display = 'none';
                pesoPaqueteFields.style.display = 'block';
                infoText = 'Define el peso o volumen total del paquete .';
                pesoPaqueteValorInput.setAttribute('required', 'required');
                pesoPaqueteUnidadSelect.setAttribute('required', 'required');
                pesoPaqueteValorInput.removeAttribute('disabled');
                pesoPaqueteUnidadSelect.removeAttribute('disabled');
                unidadesPaqueteInput.removeAttribute('required');
                unidadesPaqueteInput.setAttribute('disabled', 'disabled');
                unidadesPaqueteInput.value = 1;
                if (parseFloat(pesoPaqueteValorInput.value) <= 0) pesoPaqueteValorInput.value = 0.01;
            }
            paqueteInfoText.innerHTML = infoText;
        }

        function togglePaqueteFields() {
            const selectedValue = unidadMedidaSelect.value;
            const isPaquete = selectedValue === 'paquete';

            if (isPaquete) {
                unidadesPaqueteGroup.style.display = 'flex';
                tipoPaqueteSelect.setAttribute('required', 'required');
                toggleTipoPaquete();
            } else {
                unidadesPaqueteGroup.style.display = 'none';
                tipoPaqueteSelect.removeAttribute('required');
                unidadesPaqueteInput.removeAttribute('required');
                pesoPaqueteValorInput.removeAttribute('required');
                pesoPaqueteUnidadSelect.removeAttribute('required');
            }
        }

        unidadMedidaSelect.addEventListener('change', togglePaqueteFields);
        tipoPaqueteSelect.addEventListener('change', toggleTipoPaquete);


        togglePaqueteFields();
    });
</script>

<script src="{{ url_for('static', filename='js/productos/formularioCrearProducto.js') }}"></script>

<!-- Modal de Búsqueda de Insumos -->
<div class="modal fade" id="insumoSearchModal" tabindex="-1" aria-labelledby="insumoSearchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="insumoSearchModalLabel">Añadir Insumo a la Receta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input type="text" id="insumo-search-filter" class="form-control" placeholder="Buscar insumo...">
                </div>
                <select id="insumo-select" class="form-select" size="10">
                    <!-- Las opciones se poblarán dinámicamente -->
                </select>
                <div class="form-text">
                    Haz doble clic sobre un insumo para añadirlo a la receta.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
