{% extends "layouts/base.html" %}

{% block title %}Gestión de Empleados - Sistema Frozen{% endblock %}

{% block content %}
<div class="usuarios-container">
    <!-- Header Principal -->
    <div class="d-flex justify-content-between align-items-center pb-2 mb-4 border-bottom">
        <div>
            <h1 class="h2 mb-1">Gestión de Empleados</h1>
            <p class="text-muted mb-0">Administración de personal y roles del sistema</p>
        </div>
    </div>

    <!-- Navegación por Pestañas -->
    <ul class="nav nav-tabs-custom mb-4" id="userTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link-custom active" id="users-tab" data-bs-toggle="tab" data-bs-target="#users-panel" type="button" role="tab">
                <i class="bi bi-people me-2"></i>
                <span>Todos los Empleados</span>
                <span class="tab-indicator"></span>
            </button>
        </li>
        {% if has_permission('admin_configuracion_sistema') %}
        <li class="nav-item" role="presentation">
            <button class="nav-link-custom" id="activity-tab" data-bs-toggle="tab" data-bs-target="#activity-panel" type="button" role="tab">
                <i class="bi bi-activity me-2"></i>
                <span>Actividad de todo el tiempo</span>
                <span class="tab-indicator"></span>
            </button>
        </li>
        {% endif %}
        {% if has_permission('gestionar_autorizaciones') %}
        <li class="nav-item" role="presentation">
            <button class="nav-link-custom" id="authorizations-tab" data-bs-toggle="tab" data-bs-target="#authorizations-panel" type="button" role="tab">
                <i class="bi bi-patch-check me-2"></i>
                <span>Autorizaciones</span>
                <span class="tab-indicator"></span>
            </button>
        </li>
        {% endif %}
    </ul>

    <!-- Contenido de las Pestañas -->
    <div class="tab-content" id="userTabsContent">
        <div id="flash-container"></div>
        
        <!-- Panel de Todos los Empleados -->
        <div class="tab-pane fade show active" id="users-panel" role="tabpanel">
            {% include 'usuarios/panel_empleados.html' %}
        </div>
        
        <!-- Panel de Actividad -->
        {% if has_permission('admin_configuracion_sistema') %}
        <div class="tab-pane fade" id="activity-panel" role="tabpanel">
            {% include 'usuarios/panel_actividad.html' %}
        </div>
        {% endif %}
        
        <!-- Panel de Autorizaciones -->
        {% if has_permission('gestionar_autorizaciones') %}
        <div class="tab-pane fade" id="authorizations-panel" role="tabpanel">
            {% include 'usuarios/panel_autorizaciones.html' %}
        </div>
        {% endif %}
    </div>
</div>

<!-- Modal de Confirmación de Autorización -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmationModalLabel">Confirmar Acción</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p id="confirmationModalText">¿Estás seguro de que quieres realizar esta acción?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="confirmActionBtn">Confirmar</button>
      </div>
    </div>
  </div>
</div>


<script>
    const URL_TOTEM_ACTIVITY = "{{ url_for('api.obtener_actividad_totem') }}";
    const URL_WEB_ACTIVITY = "{{ url_for('api.obtener_actividad_web') }}";
    const CAN_MANAGE_AUTHORIZATIONS = {{ has_permission('gestionar_autorizaciones') | tojson }};
</script>
<script src="{{ url_for('static', filename='js/usuarios/gestionEmpleados.js') }}"></script>
<script src="{{ url_for('static', filename='js/usuarios/panelActividad.js') }}"></script>
<script src="{{ url_for('static', filename='js/usuarios/panelAutorizaciones.js') }}"></script>
<script src="{{ url_for('static', filename='js/usuarios/panelEmpleados.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/usuarios/listarUsuarios.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/usuarios/autorizaciones.css') }}">

{% endblock %}
