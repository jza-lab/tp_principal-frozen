<!--
Este parcial contiene los campos de formulario de información personal y laboral.
Recibe las siguientes variables del contexto de Jinja2:
- usuario: (Opcional) El objeto usuario con sus datos.
- is_new: (Boolean) True si es un formulario de creación.
- roles: (Lista) Lista de todos los roles disponibles.
- turnos: (Lista) Lista de todos los turnos disponibles.
- sectores: (Lista) Lista de todos los sectores disponibles.
- usuario_sectores_ids: (Lista) IDs de los sectores asignados al usuario.
-->

<!-- Sección de Información Personal -->
<div class="form-subsection">
    <h6 class="subsection-title">
        <i class="bi bi-person me-2"></i>Datos Básicos
    </h6>
    <div class="row g-3">
        <!-- Nombre -->
        <div class="col-md-6">
            <div class="info-item" data-field="nombre">
                <label class="info-label" for="nombre">Nombre</label>
                <div class="info-value">
                    <input type="text" class="form-control" id="nombre" name="nombre" value="{{ usuario.nombre or '' }}"
                        required placeholder="Nombre">
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>

        <!-- Apellido -->
        <div class="col-md-6">
            <div class="info-item" data-field="apellido">
                <label class="info-label" for="apellido">Apellido</label>
                <div class="info-value">
                    <input type="text" class="form-control" id="apellido" name="apellido"
                        value="{{ usuario.apellido or '' }}" required placeholder="Apellido">
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>


        <!-- Legajo -->
        <div class="col-md-6">
            <div class="info-item" data-field="legajo">
                <label class="info-label" for="legajo">Legajo</label>
                <div class="info-value">
                    <input type="text" class="form-control" id="legajo" name="legajo" value="{{ usuario.legajo or '' }}"
                        required placeholder="Número de legajo">
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>

        <!-- CUIL/CUIT -->
        <div class="col-md-6">
            <div class="info-item" data-field="cuil_cuit">
                <label class="info-label" for="cuit_parte2">CUIL/CUIT</label>
                <div class="info-value">
                    <div class="input-group cuit-input-group">
                        <input type="hidden" name="cuil_cuit" id="cuil_cuit_hidden">
                        <input type="text" class="form-control text-center" id="cuit_parte1" maxlength="2"
                            pattern="\d{2}" placeholder="XX" required
                            value="{{ usuario.cuil_cuit.split('-')[0] if usuario and usuario.cuil_cuit else '' }}"
                            aria-label="Prefijo del CUIT">
                        <span class="input-group-text">-</span>
                        <div class="form-floating" style="flex-grow: 4;">
                            <input type="text" class="form-control text-center" id="cuit_parte2" maxlength="8"
                                pattern="\d{8}" placeholder="XXXXXXXX" required
                                value="{{ usuario.cuil_cuit.split('-')[1] if usuario and usuario.cuil_cuit else '' }}">
                            <label for="cuit_parte2">
                                <i class="bi bi-person-badge me-1"></i>Cuit
                            </label>
                        </div>
                        <span class="input-group-text">-</span>
                        <input type="text" class="form-control text-center" id="cuit_parte3" maxlength="1"
                            pattern="\d{1}" placeholder="X" required
                            value="{{ usuario.cuil_cuit.split('-')[2] if usuario and usuario.cuil_cuit else '' }}"
                            aria-label="Dígito verificador">
                    </div>
                </div>
                <small id="cuil-helper" class="form-text text-muted ms-2"></small>
                <div class="invalid-feedback"></div>
            </div>
        </div>

        <!-- Email -->
        <div class="col-12">
            <div class="info-item" data-field="email">
                <label class="info-label" for="email">Correo Electrónico</label>
                <div class="info-value">
                    <input type="email" class="form-control" id="email" name="email" value="{{ usuario.email or '' }}"
                        required placeholder="nombre@empresa.com">
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>

        <!-- Teléfono -->
        <div class="col-md-6">
            <div class="info-item" data-field="telefono">
                <label class="info-label" for="telefono">Teléfono</label>
                <div class="info-value">
                    <input type="text" class="form-control" id="telefono" name="telefono"
                        value="{{ usuario.telefono or '' }}" placeholder="Ej: 1122334455" required>
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>

        <!-- Contraseña (solo para nuevos usuarios) -->
        {% if is_new %}
        <div class="col-md-6">
            <div class="info-item" data-field="password">
                <label class="info-label" for="password">Contraseña</label>
                <div class="info-value">
                    <input type="password" class="form-control" id="password" name="password" required
                        placeholder="Contraseña (mínimo 8 caracteres)">
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Sección de Información Laboral -->
<div class="form-subsection mt-4">
    <h6 class="subsection-title">
        <i class="bi bi-briefcase me-2"></i>Información Laboral
    </h6>
    <div class="row g-3">
        <!-- Selector de Rol -->
        <div class="col-12">
            <div class="info-item" data-field="role_id">
                <label class="info-label fw-bold">Rol del Empleado</label>
                <div class="info-value">
                    <div class="roles-grid" id="rolesGrid">
                        {% for rol in roles %}
                        <div class="rol-card" data-rol-id="{{ rol.id }}"
                            data-rol-name="{{ rol.nombre }}"
                            {% if usuario and usuario.role_id == rol.id %}data-selected="true" {% endif %}>
                            <div class="rol-icon">
                                <i class="bi bi-{% if 'admin' in rol.nombre.lower() %}shield-fill-check{% elif 'supervisor' in rol.nombre.lower() %}person-badge{% elif 'operario' in rol.nombre.lower() %}person-gear{% elif 'rrhh' in rol.nombre.lower() or 'recursos' in rol.nombre.lower() %}people-fill{% else %}person-circle{% endif %}"></i>
                            </div>
                            <p class="rol-nombre">{{ rol.nombre }}</p>
                            <div class="rol-check"><i class="bi bi-check-lg"></i></div>
                        </div>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="role_id" name="role_id" value="{{ usuario.role_id or '' }}" required>
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>

        <!-- Selector de Turno -->
        <div class="col-12">
            <div class="info-item" data-field="turno_id">
                <label class="info-label fw-bold">Turno de Trabajo</label>
                <div class="info-value">
                    <div class="turno-grid" id="turnoGrid">
                        {% for turno in turnos %}
                        <div class="turno-card" data-turno-id="{{ turno.id }}"
                            data-turno-name="{{ turno.nombre }}"
                            {% if usuario and usuario.turno_id == turno.id %}data-selected="true" {% endif %}>
                            <div class="turno-header">
                                <div class="turno-nombre">
                                    <i class="bi bi-{% if 'mañana' in turno.nombre.lower() or 'manana' in turno.nombre.lower() %}sunrise{% elif 'tarde' in turno.nombre.lower() %}sun{% elif 'noche' in turno.nombre.lower() %}moon-stars{% else %}clock{% endif %}"></i>
                                    {{ turno.nombre }}
                                </div>
                                <div class="turno-check"><i class="bi bi-check-lg"></i></div>
                            </div>
                            <div class="turno-horario">
                                <i class="bi bi-clock"></i>
                                <span class="turno-time">{{ turno.hora_inicio[:5] }} - {{ turno.hora_fin[:5] }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="turno_id" name="turno_id" value="{{ usuario.turno_id or '' }}">
                </div>
                <div class="invalid-feedback"></div>
            </div>
        </div>

        <!-- Selector de Sectores -->
        <div class="col-12 mt-4">
            <div class="info-item" data-field="sectores">
                <label class="info-label fw-bold">Sectores Asignados</label>
                <div class="info-value">
                    <div class="sectores-info">
                        <i class="bi bi-info-circle-fill"></i>
                        <div class="sectores-info-text">
                            <strong>Seleccione hasta 2 sectores</strong>
                        </div>
                        <div class="sectores-counter" id="sectoresCounter">
                            <i class="bi bi-check-circle-fill me-1"></i>
                            <span id="counterText">0/2</span>
                        </div>
                    </div>
                    <div class="sectores-grid" id="sectoresGrid">
                        {% for sector in sectores %}
                        <div class="sector-card" data-sector-id="{{ sector.id }}"
                            data-sector-name="{{ sector.nombre }}"
                            {% if sector.id in usuario_sectores_ids %}data-selected="true" {% endif %}>
                            <div class="sector-icon">
                                <i class="bi bi-{% if 'produccion' in sector.nombre.lower() or 'producción' in sector.nombre.lower() %}gear-fill{% elif 'almacen' in sector.nombre.lower() or 'almacén' in sector.nombre.lower() %}box-seam{% elif 'logistica' in sector.nombre.lower() or 'logística' in sector.nombre.lower() %}truck{% elif 'administracion' in sector.nombre.lower() or 'administración' in sector.nombre.lower() %}building{% elif 'calidad' in sector.nombre.lower() %}clipboard-check{% elif 'mantenimiento' in sector.nombre.lower() %}tools{% else %}grid-3x3-gap{% endif %}"></i>
                            </div>
                            <p class="sector-nombre">{{ sector.nombre }}</p>
                            <div class="sector-badge">1</div>
                        </div>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="sectores" name="sectores" value="">
                </div>
                 <div class="invalid-feedback"></div>
            </div>
        </div>
    </div>
</div>