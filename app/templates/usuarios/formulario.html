{% extends "layouts/base.html" %}

{% block title %}
    {% if is_new %}
        Crear Nuevo Usuario
    {% else %}
        Editar Usuario
    {% endif %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>
        {% if is_new %}
            Crear Nuevo Usuario
        {% else %}
            Editar Usuario
        {% endif %}
    </h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('admin_usuario.nuevo_usuario') if is_new else url_for('admin_usuario.editar_usuario', id=usuario.id) }}">
        <div class="form-group">
            <label for="legajo">Legajo</label>
            <input type="text" class="form-control" id="legajo" name="legajo" value="{{ usuario.legajo or '' }}" required>
        </div>
        <div class="form-group">
            <label for="nombre">Nombre</label>
            <input type="text" class="form-control" id="nombre" name="nombre" value="{{ usuario.nombre or '' }}" required>
        </div>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="{{ usuario.email or '' }}" required>
        </div>
        <div class="form-group">
            <label for="apellido">Apellido</label>
            <input type="text" class="form-control" id="apellido" name="apellido" value="{{ usuario.apellido or '' }}" required>
        </div>
        <div class="form-group">
            <label for="rol">Rol</label>
            <select class="form-control" id="rol" name="rol" required>
                <option value="OPERARIO" {% if usuario.rol == 'OPERARIO' %}selected{% endif %}>Operario</option>
                <option value="SUPERVISOR" {% if usuario.rol == 'SUPERVISOR' %}selected{% endif %}>Supervisor</option>
                <option value="ADMIN" {% if usuario.rol == 'ADMIN' %}selected{% endif %}>Admin</option>
            </select>
        </div>

        {% if is_new %}
        <div class="form-group">
            <label for="password">Contraseña (mínimo 8 caracteres)</label>
            <input type="password" class="form-control" id="password" name="password" required minlength="8">
        </div>
        {% endif %}

        <button type="submit" class="btn btn-primary mt-3">
            {% if is_new %}
                Crear Usuario
            {% else %}
                Guardar Cambios
            {% endif %}
        </button>
        <a href="{{ url_for('admin_usuario.listar_usuarios') }}" class="btn btn-secondary mt-3">Cancelar</a>
    </form>
</div>
{% endblock %}