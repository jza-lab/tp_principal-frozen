{% extends "layouts/app_layout.html" %}

{% block title %}Producción Activa: {{ orden.codigo }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/planificacion/foco_produccion.css') }}">
{% endblock %}

{% block app_content %}
<div class="foco-container" id="foco-container" data-op-id="{{ orden.id }}">
    <!-- Encabezado con opción para volver -->
    <div class="foco-header">
        <a href="{{ url_for('op_tabla.tablero_produccion') }}" class="btn btn-outline-secondary btn-sm">
            <i class="bi bi-arrow-left"></i> Volver al Tablero
        </a>
        <h2 class="h4 mb-0">Orden de Producción Activa</h2>
    </div>

    <!-- Panel de Pausa (inicialmente oculto) -->
    <div class="pause-overlay" id="pause-overlay" style="display: none;">
        <div class="pause-overlay-content">
            <i class="bi bi-pause-circle-fill pause-icon"></i>
            <h1>PRODUCCIÓN PAUSADA</h1>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="foco-body">
        <!-- Columna Izquierda: Datos Principales y Progreso -->
        <div class="foco-main-col">
            <div class="card h-100">
                <div class="card-header">
                    <h3>{{ orden.producto_nombre }}</h3>
                    <p class="text-muted mb-0">Nº de OP: <strong>{{ orden.codigo }}</strong></p>
                </div>
                <div class="card-body">
                    <h4>Objetivo de Producción</h4>
                    <p class="display-4">{{ orden.cantidad_planificada }} kg</p>

                    <hr>

                    <h4>Progreso Actual</h4>
                    <div class="progress-display">
                        <span id="cantidad-producida">{{ orden.cantidad_producida or 0 }}</span> / {{ orden.cantidad_planificada }} kg
                    </div>
                    <div class="progress" style="height: 25px;">
                        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: {{ (orden.cantidad_producida or 0) / orden.cantidad_planificada * 100 }}%;" aria-valuenow="{{ (orden.cantidad_producida or 0) / orden.cantidad_planificada * 100 }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    <hr>

                    <h4>Tiempo de Trabajo</h4>
                    <div class="timer-display" id="timer">00:00:00</div>
                </div>
                <div class="card-footer">
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary btn-lg" id="btn-reportar-avance"><i class="bi bi-check-circle-fill me-2"></i>Reportar Avance</button>
                        <button class="btn btn-warning btn-lg" id="btn-pausar-reanudar"><i class="bi bi-pause-fill me-2"></i>Pausar Trabajo</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Columna Derecha: Información de Apoyo -->
        <div class="foco-side-col">
            <div class="card">
                <div class="card-header">
                    <h5><i class="bi bi-info-circle me-2"></i>Información de Apoyo</h5>
                </div>
                <div class="card-body">
                    <h6>Materiales Clave / Receta</h6>
                    <ul class="list-group list-group-flush">
                        {% for ing in ingredientes %}
                            <li class="list-group-item">{{ ing.nombre_insumo }} - {{ ing.cantidad }} {{ ing.unidad_medida }}</li>
                        {% else %}
                            <li class="list-group-item">No se encontraron ingredientes.</li>
                        {% endfor %}
                    </ul>
                    <div class="d-grid mt-3">
                        <a href="#" class="btn btn-outline-primary" target="_blank">
                            <i class="bi bi-file-earmark-pdf me-2"></i>Ver Receta (PDF)
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modales -->
{% include 'planificacion/modals/modal_reportar_avance.html' %}
{% include 'planificacion/modals/modal_pausar_produccion.html' %}

{% endblock %}

{% block extra_js %}
    <script>
        // Pasar datos del backend al script de JS
        const ORDEN_ID = {{ orden.id | tojson }};
        const MOTIVOS_PARO = {{ motivos_paro | tojson }};
        const MOTIVOS_DESPERDICIO = {{ motivos_desperdicio | tojson }};
    </script>
    <script src="{{ url_for('static', filename='js/planificacion/foco_produccion.js') }}"></script>
{% endblock %}
